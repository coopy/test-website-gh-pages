webpackJsonp([0xa955f6b37600],{711:function(e,t){e.exports={data:{markdownRemark:{html:'<p>Working in React Native has been an amazing experience. Coming from React, the workflow has been nearly frictionless. There has, however, been one question lingering: <strong><em>How the hell am I going to test this?</em></strong></p>\n<figure id="media-955" class="align-none" style="max-width:188px;">\n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; z-index: 0 !important;; max-width: 188px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 143.08510638297872%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAdABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAMABf/EABcBAQADAAAAAAAAAAAAAAAAAAIAAQP/2gAMAwEAAhADEAAAAeaikaiMjARmoqT9bZn/xAAfEAACAgIBBQAAAAAAAAAAAAABAgADBBETISIxMjP/2gAIAQEAAQUCACRNGaJllKtEXv4xLPKmL65PxxOlk//EABcRAAMBAAAAAAAAAAAAAAAAAAEQEiH/2gAIAQMBAT8BAxUv/8QAFxEAAwEAAAAAAAAAAAAAAAAAABEhEP/aAAgBAgEBPwFkFHn/xAAfEAACAgEEAwAAAAAAAAAAAAAAAQIRMRASIUFRcZH/2gAIAQEABj8C3PBUVyYZUZNV5wLcnVdHf0bo4EMl60//xAAdEAACAgIDAQAAAAAAAAAAAAAAAREhQVExYXGh/9oACAEBAAE/IYi7GMllptDjousoVyT2LrZAnKU4lIcy5HN1T3FlZOT7kVfQhaP/2gAMAwEAAgADAAAAEEfsQ//EABgRAQEBAQEAAAAAAAAAAAAAAAEAESFx/9oACAEDAQE/ENGz5aOSa7f/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEQ/9oACAECAQE/EEaWQ4v/xAAfEAEAAwACAgMBAAAAAAAAAAABABEhMUFRYXGxwfD/2gAIAQEAAT8QUG2I8KrqIDeSi49/LBilvFJ+RFV6Uv0CaOdkQArhDu8h+3af0nC9q2HHmJhWjwokRSmnFQlUAAmWfUbWP//Z&apos;); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;" alt="shrugs" title="" src="/static/0-qfaWLQ1LOLp_sDCl-b508a65d077c7bd6bdabd879633e51d5-793eb.jpg" srcset="/static/0-qfaWLQ1LOLp_sDCl-b508a65d077c7bd6bdabd879633e51d5-793eb.jpg 188w" sizes="(max-width: 188px) 100vw, 188px">\n    </span>\n  </span>\n  </figure>\n<p>Specifically, what is the best way to unit test my component logic? Testing JavaScript that compiles to native code using DOM based testing utilities won&#x2019;t work. I can do my functional testing using <a href="http://appium.io/">Appium</a> or the built-in <a href="https://developer.apple.com/videos/play/wwdc2015-406/">Xcode UI tests</a>, but I needed a way to unit test my components.</p>\n<h2 id="mocks-to-the-rescue"><a href="#mocks-to-the-rescue" aria-hidden="true" class="anchor"><span aria-hidden=\'true\' class=\'anchor-icon\' /></a>Mocks to the rescue</h2>\n<p>It turns out that you can unit test React Native component logic in isolation using traditional JS test libraries by tricking React Native into returning regular React components instead of native ones.</p>\n<p>Below is my shim for React Native components and methods that allowed me to render them in my test environment:</p>\n<p><script src="https://gist.github.com/kenwheeler/b20ea372efcc52adf905.js"></script></p>\n<h2 id="mocking-react-native-with-mocha"><a href="#mocking-react-native-with-mocha" aria-hidden="true" class="anchor"><span aria-hidden=\'true\' class=\'anchor-icon\' /></a>Mocking React Native with Mocha</h2>\n<p>First I tried mocking all the things with <a href="https://facebook.github.io/jest/">Jest</a>, mostly because that is what was recommended officially. I was able to prove the concept but there were a couple of drawbacks:</p>\n<ul>\n<li>Jest is unreasonably slow, at least compared to the alternatives</li>\n<li>We typically use a Karma/Mocha/Chai on web React projects at Formidable, so it’d be nice to continue that convention</li>\n</ul>\n<p>After bidding Jest farewell, I had to figure out how this was going to work with <a href="https://mochajs.org/">Mocha</a>. I couldn’t use a Karma/Webpack setup like I would on the web because React Native uses its own packager, so using Webpack would be a redundancy. This means I had to to write a compiler to a) transpile Babel code and b) resolve the React Native module with a mock version.</p>\n<p>Mocha takes a — <em>compiler</em> argument that I used to create a custom module loader. I created one below that will transpile .js files and inject the mocked React Native methods into the <em>react-native</em> requires:</p>\n<p><script src="https://gist.github.com/kenwheeler/2e52f1b45f29bf6a1a38.js"></script></p>\n<p>Now, any time a module in a test file requires <em>react-native</em>, it will get the shim instead.</p>\n<h2 id="putting-it-all-together"><a href="#putting-it-all-together" aria-hidden="true" class="anchor"><span aria-hidden=\'true\' class=\'anchor-icon\' /></a>Putting it all together</h2>\n<p>Now I had a mock set up and a custom compiler in place, and I want to see it in action. My first order of business was to install the dependencies required to run the tests. To make things simple, I just ran:</p>\n<div class="gatsby-highlight">\n      <pre class="language-sh"><code class="language-sh">npm i --save-dev mocha chai sinon react react-dom react-addons-test-utils enzyme</code></pre>\n      </div>\n<p>To briefly review the role each tool plays in the testing architecture:</p>\n<ul>\n<li><a href="https://mochajs.org/">Mocha</a>: Javascript testing framework</li>\n<li><a href="http://chaijs.com/">Chai</a>: Assertion library</li>\n<li><a href="http://sinonjs.org/">Sinon</a>: Stubs, Mocks &amp; Spies</li>\n<li><a href="https://github.com/airbnb/enzyme">Enzyme</a>: React testing utility</li>\n<li><a href="https://facebook.github.io/react/docs/test-utils.html">React Test Utils</a>: React testing helpers</li>\n<li><a href="http://facebook.github.io/react/">React &amp; ReactDOM</a>: Used to mock React Native for testing</li>\n</ul>\n<p>Next I had to set up a <code>mocha.opts</code> file that is used to provide options to Mocha. In a <code>/test</code> directory, I created the file <code>mocha.opts</code> and added the following:</p>\n<p><script src="https://gist.github.com/kenwheeler/139d06e8cc99a27f3458.js"></script></p>\n<p>Next I created <code>compile.js</code> and <code>setup.js</code> in our test directory. The compiler code I wrote earlier went in <code>compile.js</code> and I put the following code into <code>setup.js</code> so that I could provide <code>chai.expect</code> globally, mostly for ergonomics:</p>\n<p><script src="https://gist.github.com/kenwheeler/8e789d768d8872f0c6ff.js"></script></p>\n<p>Next up, I created <code>react-native.js</code> in a new mocks directory under <code>/test</code> at <code>/test/mocks/react-native.js</code> and put the React Native mock code from earlier in there.</p>\n<p>The final piece of the puzzle is pointing my test npm script at Mocha with the specified options. I opened <code>package.json</code> and changed test under scripts to:</p>\n<div class="gatsby-highlight">\n      <pre class="language-sh"><code class="language-sh">&quot;test&quot;: &quot;mocha --opts test/mocha.opts src/**/__specs__/*.spec.js&quot;</code></pre>\n      </div>\n<p>In addition to pointing to the defined options, I also set the target to tests that use the `*.spec.js` convention, located in folders named <code>__specs__</code>.</p>\n<p>Using this convention, I colocate my tests in the folders that contain the components that I&#x2019;m testing, avoiding lengthy file paths when requiring our components.</p>\n<p><em>Now it&#x2019;s time to test!</em></p>\n<figure id="media-962" class="align-none" style="max-width: 500px;">\n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; z-index: 0 !important;; max-width: 500px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 76.2%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBP/EABUBAQEAAAAAAAAAAAAAAAAAAAED/9oADAMBAAIQAxAAAAF5rolWZhA//8QAGxABAAICAwAAAAAAAAAAAAAAAQIDERIAISL/2gAIAQEAAQUCOo1VmccrVNvU12//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwFH/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAECETEQEv/aAAgBAQAGPwJejOKUmXZrP//EABoQAQADAQEBAAAAAAAAAAAAAAEAESFRMXH/2gAIAQEAAT8hOxtS0b3VtxKCcjGH7MP0cjuDNn//2gAMAwEAAgADAAAAEKf/AP/EABcRAAMBAAAAAAAAAAAAAAAAAAABETH/2gAIAQMBAT8QUWlP/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAECAQE/EJq3/8QAHRABAQACAwADAAAAAAAAAAAAAREAITFBUWGhsf/aAAgBAQABPxCXpCswQRtA23zA0o0M+XIALWhNcfeDabvoSL3+YgAuQXdfM//Z&apos;); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;" alt="I enjoy watching those tests run and pass." title="" src="/static/0-nBQCI0SNB2pDh8Rv-835848ebbb0b5c0572711e2a887e38e0-0516f.jpg" srcset="/static/0-nBQCI0SNB2pDh8Rv-835848ebbb0b5c0572711e2a887e38e0-d8c24.jpg 200w,\n/static/0-nBQCI0SNB2pDh8Rv-835848ebbb0b5c0572711e2a887e38e0-6614e.jpg 400w,\n/static/0-nBQCI0SNB2pDh8Rv-835848ebbb0b5c0572711e2a887e38e0-0516f.jpg 500w" sizes="(max-width: 500px) 100vw, 500px">\n    </span>\n  </span>\n  </figure>\n<h2 id="getting-my-test-on"><a href="#getting-my-test-on" aria-hidden="true" class="anchor"><span aria-hidden=\'true\' class=\'anchor-icon\' /></a>Getting my test on</h2>\n<p>Say we have a simple React Native component that we want to test to make sure that it renders child nodes in response an items prop:</p>\n<p><script src="https://gist.github.com/kenwheeler/a889c7ba3042f8c70e95.js"></script></p>\n<p>We want to start by creating a <code>__specs__</code> directory in <code>src/components/</code>. Inside of that directory, we create <code>our-component.spec.js</code> as our test spec for the above component.</p>\n<p>For this test, we will be using shallow rendering, which renders components one level deep and lets us assert against the virtual DOM structure. We will also be using the enzyme library from the fine folks at Airbnb, which is an amazing utility for working with shallow renders.</p>\n<p>Let’s start by importing React, enzyme and our component, and creating a describe grouping:</p>\n<p><script src="https://gist.github.com/kenwheeler/f06c0b177ae7386eab0e.js"></script></p>\n<p>Now that we have our stage set, let’s create some mock prop data, shallow render our component, and use enzyme’s <code>findWhere</code> method to see if everything is in working order:</p>\n<p><script src="https://gist.github.com/kenwheeler/eab91734e662d7483c8b.js"></script></p>\n<p>Now, all that’s left to do is run <code>npm test</code> and let the magic happen. We are unit testing React Native components!</p>\n<h2 id="wrap-up"><a href="#wrap-up" aria-hidden="true" class="anchor"><span aria-hidden=\'true\' class=\'anchor-icon\' /></a>Wrap Up</h2>\n<p>I’ve found this approach to be pretty flexible so far, and I am feeling much better about the sturdiness of my React Native code. You may have noticed that in the React Native mock above, I had only mocked out a subset of the functionality. Using this approach may require mocking out additional components and methods depending upon what you are using in your app. I also recommend exploring all the features of enzyme, as it has an elegant API for traversing and querying a ShallowRender objects. Now go write some tests!</p>\n<p>Thanks to Ryan Roemer and Alex Lande.</p>',fields:{slug:"/blog/2016/02/08/unit-testing-react-native-with-mocha-and-enzyme/"},frontmatter:{id:9,authorId:9,categoryIds:[6],date:"2016-02-08",pageDescription:"",pageKeywords:"",pageTitle:"",path:"/2016/02/08/unit-testing-react-native-with-mocha-and-enzyme/",title:"Unit Testing React Native with Mocha and Enzyme"}}},pathContext:{slug:"/blog/2016/02/08/unit-testing-react-native-with-mocha-and-enzyme/",prev:{fields:{slug:"/blog/2016/01/27/first-impressions-with-the-webs-latest-presentation-tool-spectacle/"},frontmatter:{authorId:12,categoryIds:[5,6,14],date:"2016-01-27",id:8,title:"First Impressions with the Web's latest Presentation Tool: Spectacle"}}}}}});