webpackJsonp([23460415204650],{734:function(e,a){e.exports={data:{markdownRemark:{html:'<h2 id="safer-more-predictable-code-classlanguage-textnpmcode-publishing-with-code-classlanguage-textpublish-diffcode"><a href="#safer-more-predictable-code-classlanguage-textnpmcode-publishing-with-code-classlanguage-textpublish-diffcode" aria-hidden="true" class="anchor"><span aria-hidden=\'true\' class=\'anchor-icon\' /></a>Safer, more predictable <code class="language-text">npm</code> publishing with <code class="language-text">publish-diff</code></h2>\n<p>Publishing JavaScript projects to the <code class="language-text">npm</code> registry is an exercise that, while commonplace, is often opaque to developers and fraught with peril.</p>\n<p>The opacity comes from projects frequently publishing built files that are omitted from <code class="language-text">git</code> source and the some subtle but important differences between <code class="language-text">git</code> source and a final <code class="language-text">npm</code> registry package. (For instance, if a project has a <code class="language-text">.gitignore</code> file, but no <code class="language-text">.npmignore</code> file, <code class="language-text">.gitignore</code> will be renamed to <code class="language-text">.npmignore</code> on publication.) Moreover, developers can accidentally change files in a locally checked out repository that are successfully published to <code class="language-text">npm</code> in the incorrect mutated state.</p>\n<p>Tools like the wonderful <a href="https://github.com/sindresorhus/np"><code class="language-text">np</code></a> can help give some assurances by checking various pre-publication pitfalls. But, even then, some errors that cannot be easily discovered beforehand can still slip by into publication.</p>\n<p>Until now. <a href="https://github.com/FormidableLabs/publish-diff"><code class="language-text">publish-diff</code></a> is a simple tool that produces a prepublication text diff of what is <em>about</em> to be published with what is currently published in the <code class="language-text">npm</code> registry.</p>\n<p>Developers are already very familiar with running a <code class="language-text">git diff</code> before committing changes to a <code class="language-text">git</code> source repository. It is thus a natural extension to the land of <code class="language-text">npm</code> publication to check a diff between the last publication and the proposed new one <em>before</em> taking any permanent action.</p>\n<h2 id="getting-started"><a href="#getting-started" aria-hidden="true" class="anchor"><span aria-hidden=\'true\' class=\'anchor-icon\' /></a>Getting started</h2>\n<p>Installing <code class="language-text">publish-diff</code> is as simple as:</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> -g publish-diff</code></pre>\n      </div>\n<p>The help (<code class="language-text">-h</code>) gives us a basic rundown of usage options and examples:</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code class="language-bash">Usage: publish-diff <span class="token punctuation">[</span>options<span class="token punctuation">]</span>\n\nPreview <span class="token function">npm</span> publish changes.\n\nOptions:\n\n  -h, --help           output usage information\n  -V, --version        output the version number\n  -o, --old <span class="token operator">&lt;</span>package<span class="token operator">></span>  Old package to <span class="token function">diff</span> <span class="token punctuation">(</span>default <span class="token variable"><span class="token variable">`</span><span class="token operator">&lt;</span>package<span class="token operator">></span>@latest<span class="token variable">`</span></span><span class="token punctuation">)</span>\n  -n, --new <span class="token operator">&lt;</span>package<span class="token operator">></span>  New package to <span class="token function">diff</span> <span class="token punctuation">(</span>default <span class="token variable"><span class="token variable">`</span>process.cwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token variable">`</span></span><span class="token punctuation">)</span>\n  --no-colors          Disable colors <span class="token keyword">in</span> the outputted <span class="token function">diff</span>\n\nExamples:\n\n  <span class="token comment"># Compare (old) npm registry `latest` version vs. (new) local `process.cwd()`</span>\n  $ publish-diff\n\n  <span class="token comment"># Compare (old) npm version vs. (new) latest npm version</span>\n  $ publish-diff -o rowdy@0.4.0 -n rowdy@latest\n\n  <span class="token comment"># Compare (old) git tag/hash vs. (new) git tag/hash</span>\n  $ publish-diff -o FormidableLabs/rowdy<span class="token comment">#v0.4.0 -n FormidableLabs/rowdy#v0.5.0</span></code></pre>\n      </div>\n<h2 id="lets-diff-some-releases"><a href="#lets-diff-some-releases" aria-hidden="true" class="anchor"><span aria-hidden=\'true\' class=\'anchor-icon\' /></a>Let’s diff some releases</h2>\n<p>The most common expected use case is a local source repository checkout that is ready for publication to the <code class="language-text">npm</code> registry. Running</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code class="language-bash">$ publish-diff</code></pre>\n      </div>\n<p>checks the local project against the latest <code class="language-text">npm</code> registry package to produce a diff analogous to what will happen when a developer finally types <code class="language-text">npm publish</code>.</p>\n<p>Under the hood, <code class="language-text">publish-diff</code> relies on the quite flexible <a href="https://docs.npmjs.com/cli/pack"><code class="language-text">npm pack</code></a> command, which opens up a lot of possibilities for diffing versions of local and/or remote packages via:</p>\n<ul>\n<li>local file (<code class="language-text">/PATH/TO/my-project</code>)</li>\n<li><code class="language-text">npm</code> registry tag (<code class="language-text">my-project@beta</code>) / version (<code class="language-text">my-project@1.2.3</code>)</li>\n<li><code class="language-text">git</code> tag (<code class="language-text">GitHubOrg/my-project#v1.2.3</code>) / hash (<code class="language-text">GitHubOrg/my-project#fe25a22</code>)</li>\n</ul>\n<p>In this manner, we can easily audit previous publications to the <code class="language-text">npm</code> registry or <code class="language-text">git</code> tagged source. For example, let’s see the diff for the <code class="language-text">v0.4.0</code> vs. <code class="language-text">v0.5.0</code> release of <a href="https://github.com/FormidableLabs/rowdy"><code class="language-text">rowdy</code></a> (a functional test wrapper):</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code class="language-bash">$ publish-diff -o rowdy@0.4.0 -n rowdy@0.5.0</code></pre>\n      </div>\n<p>which gives us:</p>\n<p>\n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; z-index: 0 !important;; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 81.35048231511254%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAAB1klEQVQoz52RW2/TMBiGHTttDs2SOImPiZOGhI2uMME6iV4NoVWT4J5xQSV+H2pLR4/Sfh1uJBCsrSZ4ZH16Y+fVdwKLxWLybbZcbucPD9P75Y/75Xa7mX+fTaeT1Wo1n88nk8lmvV5vNrM9wJXmzfD6+uZsOIzSQnCV50oIwRiv6+eccyllVVWu64J9qrMXnz7fjW5vR6PR1/G4KHKETMdxbNtut9v2DksLwzAOmGV1KouyHeJWx7OO/XQMHAUB9sH/0WImohB5CDkIudDs7CJyIHIR0tqGOkILGsA4UJRLHEdZiBnAAqANgAN2wmyOFggAW2c4kjmT6UX/lRRCpYoRqiMlNJVZJjPB9GUWR0kcxXEU+b4PIfzLbHsnOEmokIQzQgjneklU7ylNUyFF0qCtrVbLNM3HlbOywkL6XHpxvPv+p2mf+B09cIyDJIkePRmG8cTm1LmqX9fqNOv286Kvypfd+qIqy5ISYvzBYXPZLfO80DGJExxiSnctU6q9RDf5RNnnvd7g8vJqMCiLQilFSBKGQdigR0UatDBNdMAsus9uPnyser23796Px184Y/pS54QN5i8OVx4yTtKMFQXJVBDosSUYR57nhSHWi/3dM9wDIfgTozxRiGrgYukAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"\n        alt="rowdy diff"\n        title=""\n        src="/static/rowdy-diff-59826968f413f19478d611965f9ca69b-fc76f.png"\n        srcset="/static/rowdy-diff-59826968f413f19478d611965f9ca69b-290b0.png 200w,\n/static/rowdy-diff-59826968f413f19478d611965f9ca69b-14201.png 400w,\n/static/rowdy-diff-59826968f413f19478d611965f9ca69b-fc76f.png 800w,\n/static/rowdy-diff-59826968f413f19478d611965f9ca69b-0fcde.png 1200w,\n/static/rowdy-diff-59826968f413f19478d611965f9ca69b-dda8f.png 1244w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  </p>\n<p>From here, there are lots of other comparison options:</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code class="language-bash">    <span class="token comment"># Diff git tag/hash vs. latest on npm registry</span>\n    $ publish-diff -o FormidableLabs/rowdy<span class="token comment">#v0.4.0  -n rowdy</span>\n    $ publish-diff -o FormidableLabs/rowdy<span class="token comment">#504735c -n rowdy@latest</span>\n    $ publish-diff -o FormidableLabs/rowdy<span class="token comment">#v0.4.0  -n rowdy@latest</span>\n\n    <span class="token comment"># Diff two old versions from git tag/hash</span>\n    $ publish-diff -o FormidableLabs/rowdy<span class="token comment">#v0.4.0  -n FormidableLabs/rowdy#v0.5.0</span>\n    $ publish-diff -o FormidableLabs/rowdy<span class="token comment">#504735c -n FormidableLabs/rowdy#fe25a22</span></code></pre>\n      </div>\n<p>The ability to diff past published versions is not only useful for package maintainers, but for <em>consuming</em> projects as well. For example, when deciding whether or not to upgrade a given library dependency to a specific version, a developer can now get a very accurate picture of how the code in that dependency will change upon upgrade.</p>\n<h2 id="publish-with-confidence"><a href="#publish-with-confidence" aria-hidden="true" class="anchor"><span aria-hidden=\'true\' class=\'anchor-icon\' /></a>Publish with confidence</h2>\n<p>With this brief tour under our belt, <code class="language-text">publish-diff</code> offers a simple means to diff your packages right before publication to ensure everything is correct. The project is available at <a href="https://github.com/FormidableLabs/publish-diff">https://github.com/FormidableLabs/publish-diff</a> and we welcome any comments, issues, and feature requests.</p>\n<p><strong>Happy diffing!</strong></p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 9.090909090909092%; position: relative; height: 0; overflow: hidden;"\n          >\n            <iframe src="https://ghbtns.com/github-btn.html?user=formidablelabs&amp;repo=publish-diff&amp;type=star&amp;count=true&amp;size=large" frameborder="0" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 9.090909090909092%; position: relative; height: 0; overflow: hidden;"\n          >\n            <iframe src="https://ghbtns.com/github-btn.html?user=ryan-roemer&amp;type=follow&amp;count=true&amp;size=large" frameborder="0" scrolling="0" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>',fields:{slug:"/blog/2016/10/19/introducing-publish-diff/"},frontmatter:{id:32,authorId:5,categoryIds:[5,6,2],date:"2016-10-19",pageDescription:"publish-diff produces a prepublication text diffs of what is about to be published with what is currently published in the npm registry.",pageKeywords:"npm, publishing, Node.js, diff",pageTitle:"Safer, more predictable `npm` publishing with `publish-diff`",path:"/2016/10/19/introducing-publish-diff/",title:"Introducing Publish-Diff"}}},pathContext:{slug:"/blog/2016/10/19/introducing-publish-diff/",prev:{fields:{slug:"/blog/2016/10/18/formidable-is-now-mobile/"},frontmatter:{authorId:3,categoryIds:[3,6,7,1,8],date:"2016-10-18",id:31,title:"Formidable is Now Mobile"}}}}}});